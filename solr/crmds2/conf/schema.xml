<?xml version="1.0" encoding="UTF-8" ?>
<schema name="cr-search" version="1.4">
  <types>
    <fieldType name="string" class="solr.StrField" sortMissingLast="true" omitNorms="true"/>
    <fieldType name="integer" class="solr.IntField"/>
    <fieldType name="date" class="solr.TrieDateField"/>
    <fieldType name="boolean" class="solr.BoolField" sortMissingLast="true" omitNorms="true"/>

    <fieldType name="text" class="solr.TextField" positionIncrementGap="100">
      <analyzer type="index">
	<charFilter class="solr.MappingCharFilterFactory" mapping="mapping-ISOLatin1Accent.txt"/>
	<charFilter class="solr.MappingCharFilterFactory" mapping="mapping-FoldToASCII.txt"/>
	<tokenizer class="solr.StandardTokenizerFactory"/>
	<filter class="solr.LowerCaseFilterFactory"/>
      </analyzer>
      <analyzer type="query">
	<charFilter class="solr.MappingCharFilterFactory" mapping="mapping-ISOLatin1Accent.txt"/>
	<charFilter class="solr.MappingCharFilterFactory" mapping="mapping-FoldToASCII.txt"/>
	<tokenizer class="solr.StandardTokenizerFactory"/>
	<filter class="solr.LowerCaseFilterFactory"/>
        <filter class="solr.StopFilterFactory" words="stopwords.txt" ignoreCase="true"/>
        <filter class="solr.LengthFilterFactory" min="2" max="100"/>
      </analyzer>
    </fieldType>

    <fieldType name="stringTokens" class="solr.TextField" sortMissingLast="true">
      <analyzer type="index">
        <tokenizer class="solr.StandardTokenizerFactory"/>
	<filter class="solr.LowerCaseFilterFactory"/>
      </analyzer>
      <analyzer type="query">
        <tokenizer class="solr.StandardTokenizerFactory"/>
	<filter class="solr.LowerCaseFilterFactory"/>
      </analyzer>
    </fieldType>
  </types>

  <fields>
    <!-- Unique key -->
    <field name="doi_key" type="string" indexed="true" stored="true" required="true"/>

    <!-- Fields for matching identifiers -->
    <field name="doi" type="string" indexed="true" stored="true" required="true" multiValued="false"/>
    <field name="issn" type="string" indexed="true" stored="true" required="false" multiValued="true"/>
    <field name="isbn" type="string" indexed="true" stored="true" required="false" multiValued="true"/>
    <field name="orcid" type="string" indexed="true" stored="true" required="false" multiValued="true"/>
    <field name="funder_doi" type="string" indexed="true" stored="true" required="false" multiValued="true"/>
    <field name="supplementary_id" type="string" indexed="true" stored="true" required="false" multiValued="true"/>
    <field name="prefix" type="string" indexed="true" stored="true" required="true" multiValued="false"/>
    <field name="owner_prefix" type="string" indexed="true" stored="true" required="true" multiValued="false"/>

    <!-- Structured contributor information -->
    <field name="contributor_given_name" type="string" indexed="true" stored="true" required="false" multiValued="true"/>
    <field name="contributor_family_name" type="string" indexed="true" stored="true" required="false" multiValued="true"/>
    <field name="contributor_suffix" type="string" indexed="true" stored="true" required="false" multiValued="true"/>
    <field name="contributor_orcid" type="string" indexed="true" stored="true" required="false" multiValied="true"/>
    <field name="contributor_type" type="string" indexed="true" stored="true" required="false" multiValued="true"/>

    <!-- Timestamps -->
    <field name="deposited_at" type="date" indexed="true" stored="true" required="true" multiValued="false"/>
    <field name="indexed_at" type="date" indexed="true" stored="true" required="true" multiValued="false"/>

    <!-- Full text search -->
    <field name="content" type="text" indexed="true" stored="false" required="true"/>

    <!-- Full text citation match -->
    <field name="content_citation" type="text" indexed="true" stored="false" required="true"/>

    <!-- Faceting -->
    <field name="type" type="string" indexed="true" stored="true" required="false"/>
    <field name="category" type="string" multiValued="true" indexed="true" stored="true" required="false"/>
    <field name="publication" type="string" indexed="true" stored="true" required="false" multiValued="true"/>
    <field name="year" type="integer" indexed="true" stored="true" required="false"/>
    <field name="oa_status" type="string" indexed="true" stored="true" required="false"/>
    <field name="funder_name" type="string" indexed="true" stored="true" required="false" multiValued="true"/>
    <field name="source" type="string" indexed="true" stored="true" required="false"/>
    <field name="archive" type="string" indexed="true" stored="true" required="false"/>
    <field name="references" type="boolean" indexed="true" stored="true" required="true"/>
    <field name="publisher" type="string" indexed="true" stored="true" required="false"/>

    <!-- Stored fields for highlighting -->
    <field name="hl_title" type="stringTokens" indexed="true" stored="true" required="false" multiValued="true"/>
    <field name="hl_volume" type="stringTokens" indexed="true" stored="true" required="false"/>
    <field name="hl_issue" type="stringTokens" indexed="true" stored="true" required="false"/>
    <field name="hl_authors" type="stringTokens" indexed="true" stored="true" required="false"/>
    <field name="hl_editors" type="stringTokens" indexed="true" stored="true" required="false"/>
    <field name="hl_chairs" type="stringTokens" indexed="true" stored="true" required="false"/>
    <field name="hl_translators" type="stringTokens" indexed="true" stored="true" required="false"/>
    <field name="hl_contributors" type="stringTokens" indexed="true" stored="true" required="false"/>
    <field name="hl_publication" type="stringTokens" indexed="true" stored="true" required="false" multiValued="true"/>
    <field name="hl_year" type="stringTokens" indexed="true" stored="true" required="false"/>
    <field name="hl_first_page" type="stringTokens" indexed="true" stored="true" required="false"/>
    <field name="hl_last_page" type="stringTokens" indexed="true" stored="true" required="false"/>
    <field name="hl_grant" type="string" indexed="true" stored="true" multiValued="true" required="false"/>
    <field name="hl_funder_name" type="stringTokens" indexed="true" stored="true" multiValued="true" required="false"/>
    <field name="hl_description" type="stringTokens" indexed="true" stored="true" multiValued="false" required="false"/>
    <field name="hl_publisher" type="stringTokens" indexed="true" stored="true" multiValued="false" required="false"/>

    <!-- Other stored fields -->

    <field name="cited_by_count" type="integer" indexed="true" stored="true" required="true"/>

    <!-- Order and cardinality of full_text_* must match. -->
    <field name="full_text_type" type="string" indexed="true" stored="true" required="false" multiValued="true"/>
    <field name="full_text_url" type="string" indexed="true" stored="true" required="false" multiValued="true"/>

    <!-- Order and cardinality of license_* must match. -->
    <field name="license_url" type="string" indexed="true" stored="true" required="false" multiValued="true"/>
    <field name="license_start" type="date" indexed="true" stored="true" required="false" multiValued="true"/>

    <field name="first_author_given" type="stringTokens" indexed="false" stored="true" required="false"/>
    <field name="first_author_surname" type="stringTokens" indexed="false" stored="true" required="false"/>
    <field name="mongo_id" type="string" indexed="false" stored="true" required="false"/>
    <field name="from_file" type="string" indexed="false" stored="true" required="false"/>
    <field name="month" type="integer" indexed="false" stored="true" required="false"/>
    <field name="day" type="integer" indexed="false" stored="true" required="false"/>
  </fields>

  <defaultSearchField>content</defaultSearchField>
  <uniqueKey>doi_key</uniqueKey>
</schema>
